<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drought Warning System - Dashboard</title>
    
    <!-- React App will be served here -->
    <style>
        /* Loading styles */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #2d5a2d, #4a7c59);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading-container">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>ðŸŒ¾ Loading Drought Monitoring Dashboard</h2>
            <p>Initializing your agricultural data...</p>
        </div>
    </div>
    
    <div id="root"></div>
    
    <!-- Authentication Token Setup -->
    <script>
        // Set up authentication for React app
        {% if user.is_authenticated %}
            // Use session authentication for now - token will be handled by the React app
            localStorage.setItem('user', JSON.stringify({
                id: {{ user.id }},
                username: '{{ user.username }}',
                first_name: '{{ user.first_name }}',
                last_name: '{{ user.last_name }}',
                email: '{{ user.email }}'
            }));
            
            // Set CSRF token for API calls
            window.csrfToken = '{{ csrf_token }}';
            
        {% else %}
            // Redirect to login if not authenticated
            window.location.href = '/dashboard/login/';
        {% endif %}
        
        // Hide loading screen when React app loads
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.opacity = '0';
                    setTimeout(() => loading.remove(), 300);
                }
            }, 1000);
        });
    </script>
    
    <!-- Load React App -->
    <!-- In production, these would be the built React files -->
    <!-- For development, we'll serve the development server -->
    <script>
        // Development mode - load from development server
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            // For development, we'll embed the React development server
            const script = document.createElement('script');
            script.src = 'http://localhost:3000/static/js/bundle.js';
            script.defer = true;
            document.head.appendChild(script);
        } else {
            // Production mode - load built files
            const scripts = [
                '{% load static %}{% static "js/main.js" %}',
            ];
            const links = [
                '{% load static %}{% static "css/main.css" %}',
            ];
            
            links.forEach(href => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = href;
                document.head.appendChild(link);
            });
            
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.defer = true;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>